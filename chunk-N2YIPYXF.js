import{d}from"./chunk-NWWTS3XC.js";import{n as i,r as u}from"./chunk-4UPO2QOB.js";import{Q as l,W as a,j as p,wa as h}from"./chunk-2I6WSUOP.js";var s=class extends Error{};s.prototype.name="InvalidTokenError";function b(r){return decodeURIComponent(atob(r).replace(/(.)/g,(e,t)=>{let o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}function g(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return b(e)}catch{return atob(e)}}function f(r,e){if(typeof r!="string")throw new s("Invalid token specified: must be a string");e||(e={});let t=e.header===!0?0:1,o=r.split(".")[t];if(typeof o!="string")throw new s(`Invalid token specified: missing part #${t+1}`);let c;try{c=g(o)}catch(n){throw new s(`Invalid token specified: invalid base64 for part #${t+1} (${n.message})`)}try{return JSON.parse(c)}catch(n){throw new s(`Invalid token specified: invalid json for part #${t+1} (${n.message})`)}}var m=class r{baseUrl="https://ecommerce.routemisr.com/api/v1/auth";http=a(u);platformId=a(h);router=a(d);userData=new p(null);constructor(){i(this.platformId)&&localStorage.getItem("token")&&this.saveUserData()}register(e){return this.http.post(`${this.baseUrl}/signup`,e)}login(e){return this.http.post(`${this.baseUrl}/signin`,e)}saveUserData(){if(i(this.platformId)){let e=localStorage.getItem("token");if(e)try{let t=f(e);this.userData.next(t)}catch{this.logout()}}}logout(){localStorage.removeItem("token"),this.userData.next(null),this.router.navigate(["/login"])}forgotPassword(e){return this.http.post(`${this.baseUrl}/forgotPasswords`,{email:e})}verifyResetCode(e){return this.http.post(`${this.baseUrl}/verifyResetCode`,{resetCode:e})}resetPassword(e){return this.http.put(`${this.baseUrl}/resetPassword`,e)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})};export{m as a};

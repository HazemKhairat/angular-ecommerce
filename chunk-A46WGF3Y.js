import{a as j}from"./chunk-A3XTQVIB.js";import{a as z}from"./chunk-EKPBVDMA.js";import{a as M,b as c,c as D,d as O,e as b,f as p,g as P,h as R,j as G,k as T,l as V,m as q,n as U,p as $}from"./chunk-RPPOXTPC.js";import{a as h}from"./chunk-B5HERMYD.js";import{a as I}from"./chunk-ECDCSSJU.js";import{d as N}from"./chunk-NWWTS3XC.js";import"./chunk-4UPO2QOB.js";import{$a as g,Ea as s,Gb as E,Pa as x,Ua as u,W as l,Wa as f,Y as y,Za as C,ab as S,bb as t,cb as e,db as m,hb as k,ib as w,mb as n,na as v,ob as F,pb as A,rb as _}from"./chunk-2I6WSUOP.js";var J=(a,i)=>i._id;function K(a,i){if(a&1&&(t(0,"option",9),n(1),e()),a&2){let o=i.$implicit;u("value",o._id),s(),A("",o.alias," - ",o.city,"")}}function L(a,i){if(a&1&&(t(0,"div",10)(1,"h3",18),n(2,"New Address Details"),e(),t(3,"div")(4,"label",19),n(5,"Details"),e(),m(6,"textarea",20),e(),t(7,"div")(8,"label",19),n(9,"Phone"),e(),m(10,"input",21),e(),t(11,"div")(12,"label",19),n(13,"City"),e(),m(14,"input",22),e()()),a&2){let o=w();u("formGroup",o.newAddressForm)}}var B=class a{cartService=l(I);addressService=l(j);orderService=l(z);router=l(N);cdr=l(E);destroyRef=l(v);addresses=[];checkoutForm=new b({selectedAddressId:new p(""),paymentMethod:new p("cash",c.required)});newAddressForm=new b({details:new p("",c.required),phone:new p("",[c.required,c.pattern(/^01[0125][0-9]{8}$/)]),city:new p("",c.required)});ngOnInit(){this.addressService.getUserAddresses().pipe(h(this.destroyRef)).subscribe(i=>{this.addresses=i.data,this.cdr.markForCheck()}),this.checkoutForm.get("selectedAddressId")?.valueChanges.pipe(h(this.destroyRef)).subscribe(i=>{i?this.newAddressForm.disable():this.newAddressForm.enable()})}get paymentMethod(){return this.checkoutForm.get("paymentMethod")?.value}handleOrder(){let i=this.cartService.cartId();if(!i)return;let o,d=this.checkoutForm.get("selectedAddressId")?.value;if(d){let r=this.addresses.find(H=>H._id===d);r&&(o={details:r.details,phone:r.phone,city:r.city})}else{if(this.newAddressForm.invalid){this.newAddressForm.markAllAsTouched();return}o=this.newAddressForm.value}this.paymentMethod==="cash"?this.orderService.createCashOrder(i,o).pipe(h(this.destroyRef)).subscribe({next:r=>{alert("Order Placed Successfully!"),this.cartService.clearCart().subscribe(),this.cdr.markForCheck(),this.router.navigate(["/allorders"])},error:r=>{console.error(r),this.cdr.markForCheck()}}):this.orderService.checkoutSession(i,o).pipe(h(this.destroyRef)).subscribe({next:r=>{r.status==="success"&&(window.location.href=r.session.url),this.cdr.markForCheck()},error:r=>{console.error(r),this.cdr.markForCheck()}})}static \u0275fac=function(o){return new(o||a)};static \u0275cmp=y({type:a,selectors:[["app-checkout"]],standalone:!0,features:[_],decls:29,vars:8,consts:[[1,"container","mx-auto","px-6","py-10","max-w-3xl"],[1,"text-3xl","font-bold","text-slate-900","mb-8","text-center"],[1,"bg-white","p-8","rounded-2xl","border","border-slate-100","shadow-xl"],[3,"ngSubmit","formGroup"],[1,"text-xl","font-bold","text-slate-800","mb-6"],[1,"mb-6"],[1,"block","text-sm","font-medium","text-slate-700","mb-2"],["formControlName","selectedAddressId",1,"w-full","px-4","py-3","rounded-lg","border","border-slate-300","focus:border-primary","outline-none"],["value",""],[3,"value"],[1,"space-y-4","mb-8","border","p-4","rounded","bg-gray-50",3,"formGroup"],[1,"text-xl","font-bold","text-slate-800","mb-6","border-t","pt-6"],[1,"flex","gap-4","mb-8"],[1,"flex","items-center","gap-2","cursor-pointer","border","p-4","rounded-lg","flex-1","hover:border-primary"],["type","radio","formControlName","paymentMethod","value","cash",1,"w-4","h-4","text-primary"],[1,"font-semibold"],["type","radio","formControlName","paymentMethod","value","card",1,"w-4","h-4","text-primary"],["type","submit",1,"w-full","py-4","bg-primary","text-white","font-bold","rounded-xl","shadow-lg","shadow-primary/30","hover:bg-primary-dark","transition-all","disabled:opacity-50",3,"disabled"],[1,"font-semibold","text-gray-700"],[1,"block","text-sm","font-medium","text-slate-700","mb-1"],["formControlName","details","rows","2",1,"w-full","px-4","py-2","rounded-lg","border","border-slate-300"],["type","tel","formControlName","phone",1,"w-full","px-4","py-2","rounded-lg","border","border-slate-300"],["type","text","formControlName","city",1,"w-full","px-4","py-2","rounded-lg","border","border-slate-300"]],template:function(o,d){if(o&1&&(t(0,"div",0)(1,"h1",1),n(2,"Checkout"),e(),t(3,"div",2)(4,"form",3),k("ngSubmit",function(){return d.handleOrder()}),t(5,"h2",4),n(6,"Shipping Address"),e(),t(7,"div",5)(8,"label",6),n(9,"Choose Address"),e(),t(10,"select",7)(11,"option",8),n(12,"-- Use a new address --"),e(),g(13,K,2,3,"option",9,J),e()(),x(15,L,15,1,"div",10),t(16,"h2",11),n(17,"Payment Method"),e(),t(18,"div",12)(19,"label",13),m(20,"input",14),t(21,"span",15),n(22,"Cash on Delivery"),e()(),t(23,"label",13),m(24,"input",16),t(25,"span",15),n(26,"Online Payment (Card)"),e()()(),t(27,"button",17),n(28),e()()()()),o&2){let r;s(4),u("formGroup",d.checkoutForm),s(9),S(d.addresses),s(2),C((r=d.checkoutForm.get("selectedAddressId"))!=null&&r.value?-1:15),s(4),f("border-primary",d.paymentMethod==="cash"),s(4),f("border-primary",d.paymentMethod==="card"),s(4),u("disabled",d.checkoutForm.invalid),s(),F(" ",d.paymentMethod==="cash"?"Place Order":"Proceed to Payment"," ")}},dependencies:[$,P,q,U,M,V,R,D,O,G,T],changeDetection:0})};export{B as CheckoutComponent};

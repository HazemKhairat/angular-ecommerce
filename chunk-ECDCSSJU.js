import{r as d}from"./chunk-4UPO2QOB.js";import{Ka as l,Kb as i,N as e,Q as o,W as u,a,b as s}from"./chunk-2I6WSUOP.js";var m=class n{baseUrl="https://ecommerce.routemisr.com/api/v1/cart";http=u(d);state=l({data:null,loaded:!1,error:null});cartData=i(()=>this.state().data);cartNumber=i(()=>this.state().data?.products.length??0);cartId=i(()=>this.state().data?._id??null);constructor(){}getLoggedUserCart(){return this.http.get(this.baseUrl).pipe(e({next:t=>this.setCart(t.data),error:t=>this.state.update(r=>s(a({},r),{error:t.message,loaded:!0}))}))}addToCart(t){return this.http.post(this.baseUrl,{productId:t}).pipe(e(r=>this.setCart(r.data)))}removeCartItem(t){return this.http.delete(`${this.baseUrl}/${t}`).pipe(e(r=>this.setCart(r.data)))}updateCartItemQuantity(t,r){return this.http.put(`${this.baseUrl}/${t}`,{count:r}).pipe(e(p=>this.setCart(p.data)))}clearCart(){return this.http.delete(this.baseUrl).pipe(e(()=>{this.state.update(t=>s(a({},t),{data:null,loaded:!0}))}))}setCart(t){this.state.update(r=>s(a({},r),{data:t,loaded:!0,error:null}))}refreshCart(){this.getLoggedUserCart().subscribe({error:t=>console.log("Cart fetch failed",t)})}checkout(t,r){return this.http.post(`https://ecommerce.routemisr.com/api/v1/orders/checkout-session/${t}?url=http://localhost:4200`,{shippingAddress:r})}static \u0275fac=function(r){return new(r||n)};static \u0275prov=o({token:n,factory:n.\u0275fac,providedIn:"root"})};export{m as a};
